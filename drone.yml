name: simple-node-app
kind: pipeline
type: kubernetes
trigger:
  branch:
    - master
steps:
  - name: image-build-push
    image: plugins/docker
    settings:
      username:
        from_secret: azure_username
      password:
        from_secret: azure_password
      repo: denouementregistry.azurecr.io/manshaehsan/denouementapi
      registry: denouementregistry.azurecr.io
      tags: latest
  - name: deploy
    environment:
      config: |
        apiVersion: v1  
        clusters:
        - cluster:
            certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUU2RENDQXRDZ0F3SUJBZ0lRSVZqazlLeGhOS0FSWWdLWWNmUjBKekFOQmdrcWhraUc5dzBCQVFzRkFEQU4KTVFzd0NRWURWUVFERXdKallUQWdGdzB5TVRBek1qRXdOREkyTkRCYUdBOHlNRFV4TURNeU1UQTBNelkwTUZvdwpEVEVMTUFrR0ExVUVBeE1DWTJFd2dnSWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUUM1CkpBdmtKR1phSy9vU1NRd2VraEYybGdxTGgvOWVacHc5TVlZSkxrSjBwclJ3KzV6Qmp5d2lGODU2cDJaN3Rpb0QKRVk3Uk5wampkOEVpYW1pMjF3c2JTMTgrS2hkNWhpcVN1N1d2K1VNS0lyTWNuWC8ycUwxZTJvY2lJaFhIcHp6VwprTGZ5T1IxSmFrQVBnbHN0S0VYUUpyeC8zTW95N3l5MnZySldMNG9ia1ZaN0NHVktXeVRYWWxRVFp5UTQzTFZHCmduK0crZy9jQWtHa21Oa3ZLanJtbmJoT0RGMUJoK3Q2MDhRdnA2bXlsSVRYN3kxeEZhQXFRajQ5UlZQT09nOFgKM0lrMTJFUC9OclRkTUx6SmVpU1E4ckR0bXZJbUxFdFVPNTd4QWFCaGtnNlRSM1huZ0pkcmFNMkcyN2RDUFFmbAp0eGhsNVNzc0kyM2MwaG5kWVo5U2lvMlhWRWphVXg0Y1BIS2E0aEUxanRuU3VCdTNhMFgxbTNVcVRaWWxSTGhHClB6RGhoZFlNL0d4RWJqQVhMaWtTcmh1MXo3bmord3hVdHFocG9rcURZSDNXZ1NveGJUL0xWKzRLOXB4WjhUYzAKajh3dC9nQVQzbGRVNU5oU1I3bnVkMCtTQWUxMitsUGdtVWVFYWF1RWNzdHVWYWlHWkcvUlNWQTRoL3pZVnIveApvQTZhWkpwc2d0ekYwemNJeG9OVVVjUkpzMXpBa215YnV5aU15YWVQTmV1OHQxTWVqUmJuVlNTK0NOWUNuN3BzCkJoY3htUWI2WlcxYkZqM3EyWnVFbjdtNVgzWUVWVTdUZ0MzSXYvaVBPNDdZcW1hWFlMMGszN0lLZXlIS0tpaFoKaTU5K3RLZG80dXVFdGNkQzMxL2EzanJlQW56MUU2bGlsNEVWZmN0Y0lRSURBUUFCbzBJd1FEQU9CZ05WSFE4QgpBZjhFQkFNQ0FxUXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVV4Z2ZNQXdyWVQxY2loTXFZCjFHNDhIcWlmaGNjd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dJQkFHRUFsNm5EdUNHUEJFZnFYZ3lacUNjNWJLQzQKeEY5ajdFRGtwdXloc243NlpadXZ3aTJjS1RiSlVUU09CaTdUY0ZpR0M5T2JoTE1GZThPNXRaZm96Wk04a25ELwo4QWRzZm5GSU9uOHJoT204REMrVEY5bk56ckxlZjlPN25Tc3VFSXIrZVo2RlFHQlVHd1NncUkwSm9DSWhYZUFpCjRpWmdOMW4vbHNaa01WMDFmZlFaMFpRTGNGczNBbFVGejUzUnNleWFlWW1SOHdoemE3MDhkcFkzNEk0aDVrTEgKZ3F1SG5EYXg1NGo3bWptYmFNZ0lmSFA3UUNpYWpMdlQwaW0zZEJ6VXNVWWQzSGZBVzE0a2Q0d0Z4VXpvRU00eApYdXlMN1dMeTlmZGxHeVFDa0JUKzNGSndydjhxTXhEMzF5UWhkSUNUSUlzcUlGbjIvVDBld0dHRnF3aUNyRDFqCkNIa1VGSmlORzh4dDVrdy91elBoaGpnU2JsQmxSb1d4V0cvRldIdTVtWXVhTTg4N1dERWNpMnZsSTljZTN2aloKa3AzSFI0dWFySGdVSDZyVzNNbUxXeWdEbUIvZFpJaThmV2hRSGs4OWZoOUM5Sk5GWE9xKzJPbjJzTzZOR1hMUQpnUW9ySVFFYVY2THF5Q1FReVN4YWdZVXA0L0V1dDhic1dLRGVGVmdaYzhnV2RrdGwzUlllaksvR2t0L3NUT3JWClFQUDNZYWpYajl3b1pYYUJnN3RwWlBKUmR4amZQamd6VkUxc1pjZFVBWG9lNklHdFZlM2Y5VlB1YzlaakJuTDEKWVlqcnFmUUNHS2x5UERBZFFVelBMMS9KVjArZTZ4YTZlT3V6cXJvbkFFWENaMk15WmZmRHk5QlFmODBnNnpFYgppay8yTlNoZStVYm1FWVhYCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
            server: https://mark-42-dns-9f8eab40.hcp.eastus.azmk8s.io:443
          name: mark-42
        contexts:
        - context:
            cluster: mark-42
            user: clusterUser_student_mark-42
          name: mark-42
        current-context: mark-42
        kind: Config
        preferences: {}
        users:
        - name: clusterUser_student_mark-42
          user:
            client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZIakNDQXdhZ0F3SUJBZ0lSQUxjc3Q0SG94bnZRUHlyNjhyWHpZaGd3RFFZSktvWklodmNOQVFFTEJRQXcKRFRFTE1Ba0dBMVVFQXhNQ1kyRXdIaGNOTWpFd016SXhNRFF5TmpRd1doY05Nak13TXpJeE1EUXpOalF3V2pBdwpNUmN3RlFZRFZRUUtFdzV6ZVhOMFpXMDZiV0Z6ZEdWeWN6RVZNQk1HQTFVRUF4TU1iV0Z6ZEdWeVkyeHBaVzUwCk1JSUNJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBZzhBTUlJQ0NnS0NBZ0VBMGZyd2d4Y0o5V0dNY2dadDhJK2wKOUFqOStXM0FDV05rQUtHRVVZVHpLMnpiWjdUamh1SUswU2FxRVZlSm9UaStjalhWZEVqRVJ5eGlTREdYYVN2bgpPek5hUlB2SG1JYXpSd1VTUWpnY0lkVVVNeTBIL3BYcXIwbUVCOFBkYk5XVDRUcnRCdGtNeFViQWR1Y1NjdWNpCnU3YVVML2lPZVN1aFVHZEJocmdjSDJnVjdaL0ErekFVcllPVW1DdzBSVVRFOVAya0psbzFFYUtYeVMwSCtoSzMKaElkSXExOTNCdnN2NS9QaldYVWFocmlJTElRdWNiSHF6T0NKeEdqQUU5S0xjMXhDcjVLRUxmTHFQeFIvUWdVOApCVUc1WHpKS2lYamYzVGtVVkdiMTJNcklpSXpvYWppbjQ2MG9YajBMbUdITndBeTJoQ2lSTHo1c0ZDb3NncVdXClQzZUxVWkcrT3laSXpmSDR3bHRkU0tjVWVaQWRIcktCK29QaEhXaXNXSi9weW11ampoUitxWWt1SWlQK0RTRmgKVGVobjM0QWhKTWhod1gvZU1aRklnTmFqSnB5MHJpVDhPUnZqWVhpOTdHTks3aEVwVTV2T2UxV2VPVGhjZEJXRApTVEhVYSt2aGFkaDBwSHZKZGxDSnRvMVlSS0Q3R0ZkWDA0emhyYXA1WWxQbUVQMUxKWWVPamhpdHpHNlJrVExuCnVrUFhaclJpUXltUVRES29jeFdaQUVQQkNHbThEdjhBV0t5RnZuNWN2MkNQVGZVN3FmeW5GQ3k1VjZkUURTMk0KUCtLY0ZSUmppb3lLekt2bGoxenJMRzJ0cmd4M2kzTUt0VnE0eDZmM0oxWmZNR3ZuT1N0ZG81V1hrclVBeW1SKwpma0QyL2Q0UGd4ZFBOajBtSTVBRk4vVUNBd0VBQWFOV01GUXdEZ1lEVlIwUEFRSC9CQVFEQWdXZ01CTUdBMVVkCkpRUU1NQW9HQ0NzR0FRVUZCd01DTUF3R0ExVWRFd0VCL3dRQ01BQXdId1lEVlIwakJCZ3dGb0FVeGdmTUF3clkKVDFjaWhNcVkxRzQ4SHFpZmhjY3dEUVlKS29aSWh2Y05BUUVMQlFBRGdnSUJBS3pIa3ZMKzAvZkxVOFBHd0prdgorVEhTdjRCcXI2eEVGdVVtZDVDWnZjamxSY0U1bW9BS3F4VFlpazBNZ09na1pCM09KaHhYUkU3azVjaFNtaGpLCmo5K0dkeDlRT2ZpVHBxRGs1dGVpbGpYU0R3Y0JaR2x1K0dWTENJb1RuT3BnUDN3KzIrUzVXRVRWWEF3M3doVjIKMzY3NHlLS3ltbDlNUEV3bm9nWDdyVExDWVlPUm1jKy80Y3NYUUlucG1sUzVNMVV3M1R5R29jZXdXamNZeHk5UQoycHZaaVkwbzRRS3I4ZjlsR0lWczYwUGl6eUxNWmdFcUp3V1hiNG5DbXlPTnMxRzlnN0tVTFhTbWZRYTRsdlFjCk1ZKzN3U2NMSmVvSWkwcWNzQWZnT1UzOVhJRWphRTk0ZTAzZVBCTytoUldQNGdISVB5cGtreTVmckU5WVBlR04KZm9KMEU3ZW1IdWVEWWcrQjd6VysxVDgzanNDeUZRMUE3TDdqWjVHbWxVekdIRTVScXlqNG9ydDhyRzFUV3o3bAo2d0JDZ0U4VmdWbHd6TktRb3c0N0NvK3plRXUwMGE2am5VejZKbUN4MFhBZ3FvQjUwMzFGY0R4WUY4bXNabGNHCk9IVVhMOXlyV2pqamVQYjhZSzFCakF3bnhhRitJRGpQR0N3Nkd1L05rc05NZGt4WmE5NmhzMURLVjVRM1QrVXAKV3VXejV2Um5uRVNWbkNyczNaTTZmNnNEWGpjdm1KSUQ3c1hxTlcwbWJHVjdvRm9sN2REc2hvZ3BOU0IwY0hkbwprRHBTRkljdEQvVXgyYlNCbDJRTGl4aDU2Ympwc3VSK1lUVXV3clNLVVJYbHhoL245WGJYcjMrYlhFK1FJYXdZClBnNm5Id2xuc0U5bTFIWlA3WExhOTl6QwotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
            client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlKS0FJQkFBS0NBZ0VBMGZyd2d4Y0o5V0dNY2dadDhJK2w5QWo5K1czQUNXTmtBS0dFVVlUeksyemJaN1RqCmh1SUswU2FxRVZlSm9UaStjalhWZEVqRVJ5eGlTREdYYVN2bk96TmFSUHZIbUlhelJ3VVNRamdjSWRVVU15MEgKL3BYcXIwbUVCOFBkYk5XVDRUcnRCdGtNeFViQWR1Y1NjdWNpdTdhVUwvaU9lU3VoVUdkQmhyZ2NIMmdWN1ovQQorekFVcllPVW1DdzBSVVRFOVAya0psbzFFYUtYeVMwSCtoSzNoSWRJcTE5M0J2c3Y1L1BqV1hVYWhyaUlMSVF1CmNiSHF6T0NKeEdqQUU5S0xjMXhDcjVLRUxmTHFQeFIvUWdVOEJVRzVYekpLaVhqZjNUa1VWR2IxMk1ySWlJem8KYWppbjQ2MG9YajBMbUdITndBeTJoQ2lSTHo1c0ZDb3NncVdXVDNlTFVaRytPeVpJemZINHdsdGRTS2NVZVpBZApIcktCK29QaEhXaXNXSi9weW11ampoUitxWWt1SWlQK0RTRmhUZWhuMzRBaEpNaGh3WC9lTVpGSWdOYWpKcHkwCnJpVDhPUnZqWVhpOTdHTks3aEVwVTV2T2UxV2VPVGhjZEJXRFNUSFVhK3ZoYWRoMHBIdkpkbENKdG8xWVJLRDcKR0ZkWDA0emhyYXA1WWxQbUVQMUxKWWVPamhpdHpHNlJrVExudWtQWFpyUmlReW1RVERLb2N4V1pBRVBCQ0dtOApEdjhBV0t5RnZuNWN2MkNQVGZVN3FmeW5GQ3k1VjZkUURTMk1QK0tjRlJSamlveUt6S3ZsajF6ckxHMnRyZ3gzCmkzTUt0VnE0eDZmM0oxWmZNR3ZuT1N0ZG81V1hrclVBeW1SK2ZrRDIvZDRQZ3hkUE5qMG1JNUFGTi9VQ0F3RUEKQVFLQ0FnRUF4WjJ6S014UDlQMmZYZGlyTXhFZUQvTStnclpGV3hDTkZ3THJNb1U3RFkxZlY5U25wVk9xOW5lNgo2cU5GeGROUGVORXRXRWo3WURobkxxWnRadStJcVBDRmJoSy9IODcxZmt0SmljU2d4VDV4eWxBQkRCb3ZTbFNYCnkyOE1QdGNxVzNoSGhvQlRRbjU1dCsxME1XdFNCdk9udHhYbmtDWDlwVnZvRVUvSU44NlBoSmtxMTd2Q1dpSlIKZ0gxcG5COUNkWWNZSzNnT0pkQ3RwUW1hVGtHN01TRFl4V0FNOXljRFNQc0E1am9OZ3VpOFQ1aisxTVdxd3JJMwpOZitYZFpCYTZYRFUyY084WGpvVk50U2xoNDdCay9qczZxaTcrWEVtemw1ZndhYzhqSkViOVZjWGpKQlJnVFovCm5XRTZQbWtkYURjT3RvWXZUUlVrUmo0Q3Nkb0JBSWNxWUxqZG0wZmRwWHF2Y0QvQmNvMkVWbTRSWk10Rk84VDcKM1hvdjB0WVZ5b0V3dkpES1dKNXZpNmhMcE1TWXFoMlFicGFqMC9MejhWRjkzRDg2L2ltdUJnUG5LRkpCUTMzeQpOSnU0d2w5ZGJ5MnhwOUdvSjlWTWN5UGozdENSaHFFQ0Z1WHY1UjRYZVA4MVRsc3JlUTd1TUJQSWlUcGZ1czM5CnRmSy93UlRxcUJaN05KSkdGM1Rqa3ZVTnJsTEhMKzFJckJXaCtSUVQ2ZUZWSUxDb2tnbTJCVHFLc2xBdzZ1ZDAKZ3BKMU83WXk3elMvcU9kVVo3cnVrT0tUdWZpbk4rWWxsSWlldFQwTWIwKzZIOW8xbmZOOVhoQUY3aDlrUFNaVAo3S2dEQjhKalNyQzRJUEZ0MjBCMjMvamR1Ry85U1p2QWsvajBxc1JDd2RnTXR4TllRQ2tDZ2dFQkFQc0kvUXA2Cm5wYzFMc2U5YnRDd2x3Q1FjZjdnM0FYYmZUeXRnaW9EcE5abE5aMWhSKzZKZ2l6dkhRcEE3eDBEZWV3aHArL0kKckU5OTIrVjNpeEJTc252YUdBZlNXNHRBakZpYkVDTzk4U1EzWEVIZ3hwdnZjVmZvd05ucGp4bkRpTFhyZG9UYgpWMkpHTzdTUkR6NzBOU243NUR2WjFYWHlHd1NGOTBYWGg0Vzg1NnVjSXhKbmZyejVXd0VWeGlqTmllcENpK0t3Cm5iZURMR1YyUjAraTJNSzBPWnlXUkJqTU10M0F5ZDFQNEcyMDlSUzk2TTdkUFVjQW02bnpOOTNmQVFFN1B1b24KdHNONnl0WU8vYWkxRFdSSFdpd3R5MHVXUWxBQXpuOHdaWnFqWUtEOUpPUXViRGlyTjJ1NVFURmpQRmdOb0VNMQpVSWpRTkQwVnk1Q29lUE1DZ2dFQkFOWWlGamtPcnNIY0FhNlU5NFNvVVdUdzZIUHN0d21kZUZBbytxQUVvaktHCmNsT3JsWEZ0bXpWVVhzTWdqWG5ZM1hzbHJ5RXFpOGtyM2ZHSWxqSWFKckZtS3BMTnpSeWFWcC95RlRDMzFlUDkKQ2JVTVdDZzA3dlRWYjZyN1FVWW96RjU4MWc2YzVtNm9jTHg0RXc4TmgveGpTNmlvVHhSVVV6RnErb1Rac0dxdQpPYUJNZUdMbFFmZG4zNmdKbEc2eXI5WmpIZUlRU1BoZVZiWm5zbWNWQ0NRZVBJUUR1ck13RjVnektYSUtvUDJ6Ckt3ZmtzTTRKaDZ4MWVIenkvYS9FSjVMRXJpa29YckxFVlFkdWhpRjNKTWpyUTdsOUNPQVFNWjR4WWRoL1BCcDQKZWZNNjAzOWREWEx5SGFTTldncTJ6bnhsMThxMjJpdU9ibFBIWllsV3hYY0NnZ0VBWmZOb2tQRHJwNDA1eW5UcwpwR1NUYnU4NjNNQ0ZtdnRoQ1Z1T0dYSVJaK0VDdlQvYzdzdDV5clh4blZCeHk5NjFqV2k5dzJ4RVRxUld3Z0tpCnY2WldSbVowaS9pcXBRczU5R0pGVTc2NFNIVVRTczMyMnkyTFlxQnNjaE9nd2wzZkQ4THBCMXZ0U1VRc3kxQisKV0pybFhIK29XWVpHWXZoSWNMWFhqczNSaEVjTDcyNGg4RCtJQVVkajVqVHBuWGljSWorVWdDUXFhWFVrZXJCbQpsYmtWUHozaWgrMmZDbE1qOVZ0dW9Dcm9ncVdUUXpFOWM0WDJkUGVTUUpzK2ZTVXNTMHU4YVd4bmxVd3hSRzRpCkpub2hUakNNTnBVQ2sxZ2E1bEx0aWtvbGVZQVFwbEVvd21MNElLdW9mbDltVXFCeXlXLy9Qa3hRd0wrTjk2RDYKWTIySWNRS0NBUUFUL2pUQytRcjZFTGViZkU4cjlLYzgzSDFuclhkZGozVlhUcXd2MnA3bVJzVlA2SnBZYjlwbwovVXFudjFkV1JCaFIwaS9xMGRVaFlGWWxvaEliOVhNZFp5T2NkMWlxVGdLK2hsVFNLcWZ1MUlaZWdCdVBEWG91CkkrdDhORjlnMUpoWVRpR1NWYlh5S1FuMW51UndxRnZGQmVSZmgrOXlQM2xSQ09NQkdtNHRWNzBMcVhnb0M2M0EKRXRQQUZiemxKUXZqNFhjOXp6Vnc4eVhmbFFrRU5PT0FzODRFcVhCNklJaGpib3QxR1diMHFSRGdlTXJGUWdDSAo2cVBvVHF1L0NIcUZhcFcwUkErcmMwZFpIVW1xd0R3UUFsOWRaejQzNVdzc2tRSEl2QUI1bkR3T3FMUnNsTnlYCm1lR0lwcVg4a0JyeFpIVGtlWFFmVXZvY0dtYnhqc2Q3QW9JQkFDRVVjYm93Qldkanh5OVlYNlhxZG96dGRQSDIKeFRCUmZueUI3REg0dlppaGcrMWVJL3NGTUo2Rm4xNDEvdVRsM3lhNEtrRVFkeDFZVVUvYlY0VUJ3a3RaanNwZgpPd2N4NytHZ0JxZndJMktXa1FKcUxKRy8yUDdvTU5EMDBFL2k3OStVUW9xcys0WGZJVlR2bW9SWDNpWVdvTXZkCitTUkFpTGFQT2xrWHVaUURSRjNVY2lpRDZkWWxHSERWOEJyL2luNWg3ZTg0NUkveitrVkpIRm1EcDNmZit4bDgKenU2cTErbUpFaU1uVk85THpRRk5UVWl1dk9xdGt6emtzK2xLVUZycWV4eVZFWFJldzhmZER1dGZZdlZNeHgvNQp6SlROcENrSXV3K0svYnE1bVdFczIwRi9LTDdaZ0U5a0p3NndJWmVNeHo1TU8zVkZKREE2eVFiazM3ST0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K
            token: 4d244360fd14e641eeb1ddcf94ba3813da4e7980c4589bc45991a5731b3faf68c81803d584207118fc6bc1afb605da630170225d1ccd96c9b821beeb04730725
    image: ubuntu
    commands:
      - mkdir ~/./kube
      - echo $config ~/.kube/config
      - apt-get install curl 
      - curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
      - curl -LO "https://dl.k8s.io/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256"
      - echo "$(<kubectl.sha256) kubectl" | sha256sum --check
      - sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
      - kubectl version --client
      - kubectl apply -f . -n denouement
